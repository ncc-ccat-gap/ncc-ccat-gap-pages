<html lang="ja">
<head>
  <title>AWS EC2 を使用して Linux サーバを構築する</title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <link rel="stylesheet" type="text/css" href="./github-markdown.css"/>
    <link rel="stylesheet" type="text/css" href="./extention.css"/>
</head>
<body>
<p>2019.7.31　作成　NCC</p>
<h1>
<a id="user-content-aws-ec2-を使用して-linux-サーバを構築する" class="anchor" href="#aws-ec2-%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6-linux-%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>AWS EC2 を使用して Linux サーバを構築する</h1>
<h2>
<a id="user-content-1-aws-コンソールにログイン" class="anchor" href="#1-aws-%E3%82%B3%E3%83%B3%E3%82%BD%E3%83%BC%E3%83%AB%E3%81%AB%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1. AWS コンソールにログイン</h2>
<p><a href="https://aws.amazon.com" rel="nofollow">https://aws.amazon.com</a> を web ブラウザで開き、「コンソールにサインイン」をクリックします。</p>
<p><a href="../image/ec2_1.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_1.PNG" alt="" style="max-width:100%;"></a></p>
<p>次の画面でアカウント、ユーザ名、パスワードを入力します。</p>
<p><a href="../image/ec2_2.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_2.PNG" alt="" style="max-width:100%;"></a></p>
<p>AWS マネジメントコンソールで東京リージョンを選択しておきます。</p>
<p><a href="../image/ec2_3.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_3.PNG" alt="" style="max-width:100%;"></a></p>
<h2>
<a id="user-content-2-ec2-インスタンスの起動" class="anchor" href="#2-ec2-%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E8%B5%B7%E5%8B%95" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2. EC2 インスタンスの起動</h2>
<p>AWS マネジメントコンソールで EC2 サービスを選択します。</p>
<p><a href="../image/ec2_4.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_4.PNG" alt="" style="max-width:100%;"></a></p>
<p>EC2 ダッシュボードが表示されますので、「インスタンスの作成」ボタンを押します。</p>
<p><a href="../image/ec2_5.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_5.PNG" alt="" style="max-width:100%;"></a></p>
<p>まず最初にマシンイメージを選択します。今回はAmazon Linux2 AMI (HVM) を使用します。<br>
マシンイメージ名の横にある「選択」ボタンを押します。</p>
<p><a href="../image/ec2_6.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_6.PNG" alt="" style="max-width:100%;"></a></p>
<p>次にインスタンスタイプを選択します。今回はt3.2xlargeを使用します。<br>
インスタンスタイプ名の先頭にあるチェックボックスを選択したら、ページの最後にある「次の手順」ボタンを押します。</p>
<p><a href="../image/ec2_7.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_7.PNG" alt="" style="max-width:100%;"></a></p>
<p>「インスタンスの詳細の設定」では何もせず、ページの最後にある「次の手順」ボタンを押します。</p>
<p><a href="../image/ec2_8.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_8.PNG" alt="" style="max-width:100%;"></a></p>
<p>「ストレージの追加」では 1T のボリュームを追加します。<br>
まず、「新しいボリュームの追加」ボタンを押して行を追加し、サイズを「1000」と入力します。<br>
入力後、ページの最後にある「次の手順」ボタンを押します。</p>
<p><a href="../image/ec2_9.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_9.PNG" alt="" style="max-width:100%;"></a></p>
<p>「タグの追加」では作成するインスタンスに名前をつけます。<br>
必須ではありませんが、名前がついていた方が管理しやすくなります。<br>
まず、「タグの追加」ボタンを押して行を追加し、キーに「Name」、値に名前 (任意の英数字) を入力します。<br>
入力後、ページの最後にある「次の手順」ボタンを押します。</p>
<p><a href="../image/ec2_10.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_10.PNG" alt="" style="max-width:100%;"></a></p>
<p>最後は「セキュリティグループの設定」です。<br>
今回は新しくセキュリティグループを作成しますが、既存のグループがあればそちらを選択しても構いません。<br>
まず「セキュリティグループ名」「説明」を入力します。<br>
タイプ「SSH」を選択し、ソースにアクセスを許可しようとしている IP アドレスを入力します。「マイIP」を選択すると、現在の自分のIPアドレスを設定することができます。<br>
入力後、ページの最後にある「確認と作成」ボタンを押します。</p>
<p><a href="../image/ec2_11.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_11.PNG" alt="" style="max-width:100%;"></a></p>
<p>確認画面が表示されますので、問題なければ「起動」ボタンを押してください。</p>
<p><a href="../image/ec2_12.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_12.PNG" alt="" style="max-width:100%;"></a></p>
<p>キーペアの選択画面が表示されます。<br>
ここでは新しいキーペアを作成しますが、既存のキーペアがある場合はそちらを使用しても構いません。<br>
「キーペア名」を入力し、「キーペアのダウンロード」ボタンを押します。</p>
<p><a href="../image/ec2_13.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_13.PNG" alt="" style="max-width:100%;"></a></p>
<p>今回作成するキーペアはここでしかダウンロードできません。大切に保管してください。</p>
<p><a href="../image/ec2_14.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_14.PNG" alt="" style="max-width:100%;"></a></p>
<p>キーペアをダウンロードしたら、「インスタンスの作成」ボタンを押します。</p>
<p><a href="../image/ec2_15.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_15.PNG" alt="" style="max-width:100%;"></a></p>
<p>作成ステータス画面が表示されます。「インスタンスの表示」ボタンを押します。</p>
<p><a href="../image/ec2_16.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_16.PNG" alt="" style="max-width:100%;"></a></p>
<p>EC2 インスタンスリストが表示されます。<br>
今回作成したインスタンスはまだ作成中であることが分かります。</p>
<p><a href="../image/ec2_17.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_17.PNG" alt="" style="max-width:100%;"></a></p>
<p>「チェックに合格しました」と表示されれば使用可能です。</p>
<p><a href="../image/ec2_18.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_18.PNG" alt="" style="max-width:100%;"></a></p>
<h2>
<a id="user-content-3-作成したインスタンスに-ssh-ログイン" class="anchor" href="#3-%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9F%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AB-ssh-%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3. 作成したインスタンスに SSH ログイン</h2>
<p>先ほどのインスタンスリストで今回作成したインスタンスのパブリック DNS をコピーしておきます。</p>
<p><a href="../image/ec2_19.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_19.PNG" alt="" style="max-width:100%;"></a></p>
<p>ターミナルを開きます。</p>
<ol>
<li>
<p>先ほどダウンロードしたキーペアのパーミッションを変更します。<br>
ここでは <code>~/.ssh/</code> の下に保存していますが、適宜読み替えてください。</p>
</li>
<li>
<p>次に <code>ssh</code> コマンドで作成したインスタンスにログインします。<br>
Amazon Linux の場合、ユーザ名は <code>ec2-user</code> 固定です。<br>
サーバのアドレスは先ほどコピーしたパブリック DNS を張り付けてください。</p>
</li>
<li>
<p>続けますかと聞かれたら <code>yes</code> と入力してください。</p>
</li>
</ol>
<p><a href="../image/ec2_20.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_20.PNG" alt="" style="max-width:100%;"></a></p>
<p>ログインできましたか？</p>
<h2>
<a id="user-content-4-work-ディレクトリの準備" class="anchor" href="#4-work-%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AE%E6%BA%96%E5%82%99" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>4. work ディレクトリの準備</h2>
<p>アタッチしたディスクが存在するかを確認します。</p>
<div class="highlight highlight-source-shell"><pre>$ ls /dev/sdb
/dev/sdb</pre></div>
<p>フォーマットします。</p>
<div class="highlight highlight-source-shell"><pre>$ sudo mkfs -t ext4 /dev/sdb
mke2fs 1.42.9 (28-Dec-2013)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
65536000 inodes, 262144000 blocks
13107200 blocks (5.00%) reserved <span class="pl-k">for</span> the super user
First data block=0
Maximum filesystem blocks=2409627648
8000 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks:
        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,
        4096000, 7962624, 11239424, 20480000, 23887872, 71663616, 78675968,
        102400000, 214990848

Allocating group tables: <span class="pl-k">done</span>
Writing inode tables: <span class="pl-k">done</span>
Creating journal (32768 blocks): <span class="pl-k">done</span>
Writing superblocks and filesystem accounting information: <span class="pl-k">done</span></pre></div>
<p>work ディレクトリにマウントします。</p>
<div class="highlight highlight-source-shell"><pre>$ sudo mkdir /work
$ sudo mount /dev/sdb /work
$ df -h
Filesystem      Size  Used Avail Use% Mounted on
devtmpfs         16G     0   16G   0% /dev
tmpfs            16G     0   16G   0% /dev/shm
tmpfs            16G  448K   16G   1% /run
tmpfs            16G     0   16G   0% /sys/fs/cgroup
/dev/nvme0n1p1  8.0G  1.2G  6.8G  15% /
tmpfs           3.2G     0  3.2G   0% /run/user/0
tmpfs           3.2G     0  3.2G   0% /run/user/1000
/dev/nvme1n1    985G   77M  935G   1% /work</pre></div>
<p>work ディレクトリのパーミッションを変更します。</p>
<div class="highlight highlight-source-shell"><pre>$ touch /work/file1
touch: cannot touch ‘/work/file1’: Permission denied
$ sudo chown ec2-user /work
$ touch /work/file1
$ ls -l /work
total 16
-rw-rw-r-- 1 ec2-user ec2-user     0 Jul 31 02:35 file1
drwx------ 2 root     root     16384 Jul 31 02:28 lost+found</pre></div>
<h2>
<a id="user-content-3-片付け" class="anchor" href="#3-%E7%89%87%E4%BB%98%E3%81%91" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3. 片付け</h2>
<h3>
<a id="user-content-31-ターミナルから抜ける" class="anchor" href="#31-%E3%82%BF%E3%83%BC%E3%83%9F%E3%83%8A%E3%83%AB%E3%81%8B%E3%82%89%E6%8A%9C%E3%81%91%E3%82%8B" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3.1 ターミナルから抜ける</h3>
<p><code>exit</code> でログアウトします。</p>
<div class="highlight highlight-source-shell"><pre>$ <span class="pl-c1">exit</span>
<span class="pl-c1">logout</span>
Connection to ec2-52-194-226-103.ap-northeast-1.compute.amazonaws.com closed.</pre></div>
<h3>
<a id="user-content-32-インスタンスを停止する" class="anchor" href="#32-%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%82%92%E5%81%9C%E6%AD%A2%E3%81%99%E3%82%8B" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3.2 インスタンスを停止する</h3>
<p>インスタンスを起動したままでは課金対象になってしまいますので、使用しない場合は停止しておきます。<br>
ただし、ディスクは停止した状態であっても課金対象となりますので、無課金状態にはなりません。</p>
<p>※完全に削除したい場合はこの項目を飛ばして、次の 「3.3 インスタンスを削除する」に進んでください。</p>
<p>AWS マネジメントコンソールから作成したインスタンスを選択し、「アクション」→「インスタンスの状態」とたどって「停止」をクリックします。</p>
<p><a href="../image/ec2_21.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_21.PNG" alt="" style="max-width:100%;"></a></p>
<p>確認画面が表示されますので、停止したいインスタンスを十分に確認したら「停止する」ボタンを押します。</p>
<p><a href="../image/ec2_22.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_22.PNG" alt="" style="max-width:100%;"></a></p>
<p>停止処理が始まりました。</p>
<p><a href="../image/ec2_23.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_23.PNG" alt="" style="max-width:100%;"></a></p>
<p>完全に停止すると「stopped」と表示されます。</p>
<p><a href="../image/ec2_24.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_24.PNG" alt="" style="max-width:100%;"></a></p>
<h3>
<a id="user-content-33-インスタンスを削除する" class="anchor" href="#33-%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3.3 インスタンスを削除する</h3>
<p>必要のないインスタンスは削除します。</p>
<p>AWS マネジメントコンソールから作成したインスタンスを選択し、「アクション」→「インスタンスの状態」とたどって「終了」をクリックします。</p>
<p><a href="../image/ec2_25.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_25.PNG" alt="" style="max-width:100%;"></a></p>
<p>確認画面が表示されますので、削除したいインスタンスを十分に確認したら「はい、削除する」ボタンを押します。</p>
<p><a href="../image/ec2_26.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_26.PNG" alt="" style="max-width:100%;"></a></p>
<p>削除されたインスタンスは「terminated」と表示されます。一定期間表示されますが、その後リストからも消えます。</p>
<p><a href="../image/ec2_27.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_27.PNG" alt="" style="max-width:100%;"></a></p>
<p>アタッチしたボリュームを削除します。<br>
※インスタンス削除時、一緒に削除する設定にしていた場合はすでに削除されていますので、この操作は必要ありません。</p>
<p>左端のメニューから「ボリューム」を選択し、ボリュームを表示します。<br>
今回作成したボリュームを選択した後、「アクション」→「Delete Volume」をクリックします。</p>
<p><a href="../image/ec2_32.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_32.PNG" alt="" style="max-width:100%;"></a></p>
<p>確認画面が表示されますので、内容を確認したら、「はい、削除する」ボタンを押します。</p>
<p><a href="../image/ec2_33.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_33.PNG" alt="" style="max-width:100%;"></a></p>
<p>今回作成したセキュリティグループを削除します。</p>
<p>左端のメニューから「セキュリティグループ」を選択し、セキュリティグループを表示します。<br>
今回作成したセキュリティグループを選択した後、「アクション」→「セキュリティグループの削除」をクリックします。</p>
<p><a href="../image/ec2_28.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_28.PNG" alt="" style="max-width:100%;"></a></p>
<p>確認画面が表示されますので、内容を確認したら、「はい、削除する」ボタンを押します。</p>
<p><a href="../image/ec2_29.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_29.PNG" alt="" style="max-width:100%;"></a></p>
<p>今回作成したキーペアを削除します。</p>
<p>左端のメニューから「キーペア」を選択しキーペアを表示します。<br>
今回作成したキーペアを選択した後、「削除」ボタンを押します。</p>
<p><a href="../image/ec2_30.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_30.PNG" alt="" style="max-width:100%;"></a></p>
<p>確認画面が表示されますので、内容を確認したら、「はい」ボタンを押します。</p>
<p><a href="../image/ec2_31.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_31.PNG" alt="" style="max-width:100%;"></a></p>

</body>
</html>
