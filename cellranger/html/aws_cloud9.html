<html lang="ja">
<head>
  <title>AWS Cloud9 を使用して Linux サーバを構築する</title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <link rel="stylesheet" type="text/css" href="./github-markdown.css"/>
    <link rel="stylesheet" type="text/css" href="./extention.css"/>
<script src="./js/jquery.js"></script>
<script src="./js/toc.js"></script>
</head>
<body>
<div class="toc">
</div>
<div id="contents">

<p>2019.7.31　作成　NCC</p>
<h1>
<a id="user-content-aws-cloud9-を使用して-linux-サーバを構築する" class="anchor" href="#aws-cloud9-%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6-linux-%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>AWS Cloud9 を使用して Linux サーバを構築する</h1>
<h2>
<a id="user-content-1-aws-コンソールにログイン" class="anchor" href="#1-aws-%E3%82%B3%E3%83%B3%E3%82%BD%E3%83%BC%E3%83%AB%E3%81%AB%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1. AWS コンソールにログイン</h2>
<p><a href="https://aws.amazon.com" rel="nofollow">https://aws.amazon.com</a> を web ブラウザで開き、「コンソールにサインイン」をクリックします。</p>
<p><a href="../image/ec2_1.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_1.PNG" alt="" style="max-width:100%;"></a></p>
<p>次の画面でアカウント、ユーザ名、パスワードを入力します。</p>
<p><a href="../image/ec2_2.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_2.PNG" alt="" style="max-width:100%;"></a></p>
<p>AWS マネジメントコンソールで東京リージョンを選択しておきます。</p>
<p><a href="../image/ec2_3.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_3.PNG" alt="" style="max-width:100%;"></a></p>
<h2>
<a id="user-content-2-ec2-インスタンスの起動" class="anchor" href="#2-ec2-%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E8%B5%B7%E5%8B%95" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2. EC2 インスタンスの起動</h2>
<p>AWS マネジメントコンソールで Cloud9 サービスを選択します。</p>
<p><a href="../image/c9_1.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/c9_1.PNG" alt="" style="max-width:100%;"></a></p>
<p>「Create environment」をクリックします。</p>
<p><a href="../image/c9_2.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/c9_2.PNG" alt="" style="max-width:100%;"></a></p>
<p>まず作成する cloud9 環境に名前を付けます。<br>
「Name」に名前 (任意の英数字) を入力し、「Next step」をクリックします。</p>
<p><a href="../image/c9_3.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/c9_3.PNG" alt="" style="max-width:100%;"></a></p>
<p>次に cloud9 環境の設定を以下内容で設定してください。</p>
<ul>
<li>Environment type: "Create a new instance for environment (EC2)"</li>
<li>Instance type: "Other instance type" にチェックをつけて、"t3.2xlarge" を選択</li>
<li>Platform: "Amazon Linux"</li>
<li>Cost-saving setting: "After 30 minutes (Default)</li>
</ul>
<p>入力出来たら、ページの最後にある「Next step」をクリックします。</p>
<p><a href="../image/c9_4.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/c9_4.PNG" alt="" style="max-width:100%;"></a></p>
<p>確認画面が表示されますので、問題なければ「Create environment」をクリックしてください。</p>
<p><a href="../image/c9_5.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/c9_5.PNG" alt="" style="max-width:100%;"></a></p>
<p>作成が開始されますので、黒い画面が消えるまで待ちます。</p>
<p><a href="../image/c9_6.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/c9_6.PNG" alt="" style="max-width:100%;"></a></p>
<p>このような画面が表示されれば使用可能です。</p>
<p><a href="../image/c9_7.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/c9_7.PNG" alt="" style="max-width:100%;"></a></p>
<h2>
<a id="user-content-3-ボリュームの追加" class="anchor" href="#3-%E3%83%9C%E3%83%AA%E3%83%A5%E3%83%BC%E3%83%A0%E3%81%AE%E8%BF%BD%E5%8A%A0" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3. ボリュームの追加</h2>
<p>今回は 1T のボリュームが必要ですので、追加でボリュームを作成します。</p>
<p>AWS マネジメントコンソールで EC2 サービスを選択します。</p>
<p><a href="../image/ec2_4.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_4.PNG" alt="" style="max-width:100%;"></a></p>
<p>EC2 ダッシュボードが表示されますので、左端のメニューから「ボリューム」を選択し、「ボリュームの作成」ボタンを押します。</p>
<p><a href="../image/c9_8.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/c9_8.PNG" alt="" style="max-width:100%;"></a></p>
<p>以下内容で設定してください。<br>
それ以外の項目はデフォルトのままで構いません。</p>
<ul>
<li>ボリュームタイプ: gp2</li>
<li>サイズ (GiB): 1000</li>
<li>キー: 「タグの追加」を押して行を追加した後、キーに「Name」、値に名前 (任意の英数字) を入力します</li>
</ul>
<p>入力出来たら、「ボリュームの作成」ボタンを押します。</p>
<p><a href="../image/c9_9.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/c9_9.PNG" alt="" style="max-width:100%;"></a></p>
<p>「閉じる」ボタンを押します。</p>
<p><a href="../image/c9_10.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/c9_10.PNG" alt="" style="max-width:100%;"></a></p>
<p>作成したボリュームは「available」になっています。</p>
<p><a href="../image/c9_11.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/c9_11.PNG" alt="" style="max-width:100%;"></a></p>
<p>次に作成したボリュームを cloud9 環境にアタッチします。</p>
<p>作成したボリュームを選択した後、「アクション」→「ボリュームのアタッチ」の順にクリックします。</p>
<p><a href="../image/c9_12.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/c9_12.PNG" alt="" style="max-width:100%;"></a></p>
<p>ボリュームのアタッチするインスタンスを選択します。<br>
cloud9 で作成したインスタンスには "aws-cloud9-{自分で設定したcloud9の名前}-{英数字}" という名前が付けられています。</p>
<p><a href="../image/c9_13.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/c9_13.PNG" alt="" style="max-width:100%;"></a></p>
<p>アタッチ先が "/dev/sdf" であることを確認して、「アタッチ」ボタンを押します。</p>
<p><a href="../image/c9_14.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/c9_14.PNG" alt="" style="max-width:100%;"></a></p>
<p>状態が「available」から「in-use」になれば成功です。</p>
<p><a href="../image/c9_15.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/c9_15.PNG" alt="" style="max-width:100%;"></a></p>
<h2>
<a id="user-content-4-work-ディレクトリの準備" class="anchor" href="#4-work-%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AE%E6%BA%96%E5%82%99" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>4. work ディレクトリの準備</h2>
<p>ここからは作成した cloud9 でコマンドを実行します。<br>
黄色で囲った部分がターミナルです。</p>
<p><a href="../image/c9_16.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/c9_16.PNG" alt="" style="max-width:100%;"></a></p>
<p>まず、アタッチしたディスクが存在するかを確認します。</p>
<div class="highlight highlight-source-shell"><pre>$ ls /dev/sdf
/dev/sdf</pre></div>
<p>フォーマットします。</p>
<div class="highlight highlight-source-shell"><pre>$ sudo mkfs -t ext4 /dev/sdf
mke2fs 1.43.5 (04-Aug-2017)
Creating filesystem with 262144000 4k blocks and 65536000 inodes
Filesystem UUID: 6e3c88af-05e2-4350-935e-6dd91301a047
Superblock backups stored on blocks: 
        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
        4096000, 7962624, 11239424, 20480000, 23887872, 71663616, 78675968, 
        102400000, 214990848

Allocating group tables: <span class="pl-k">done</span>                            
Writing inode tables: <span class="pl-k">done</span>                            
Creating journal (262144 blocks): <span class="pl-k">done</span>
Writing superblocks and filesystem accounting information: <span class="pl-k">done</span>     </pre></div>
<p>work ディレクトリにマウントします。</p>
<div class="highlight highlight-source-shell"><pre>$ sudo mkdir /work
$ sudo mount /dev/sdf /work
$ df -h
Filesystem      Size  Used Avail Use% Mounted on
devtmpfs         16G   60K   16G   1% /dev
tmpfs            16G     0   16G   0% /dev/shm
/dev/nvme0n1p1  9.8G  5.7G  4.0G  60% /
/dev/nvme1n1    984G   77M  934G   1% /work</pre></div>
<p>work ディレクトリのパーミッションを変更します。</p>
<div class="highlight highlight-source-shell"><pre>$ touch /work/file1
touch: cannot touch ‘/work/file1’: Permission denied
$ whoami
ec2-user
$ sudo chown ec2-user /work
$ touch /work/file1
$ ls -l /work
total 16
-rw-rw-r-- 1 ec2-user ec2-user     0 Jul 31 06:51 file1
drwx------ 2 root     root     16384 Jul 31 06:50 lost+found</pre></div>
<h2>
<a id="user-content-3-片付け" class="anchor" href="#3-%E7%89%87%E4%BB%98%E3%81%91" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3. 片付け</h2>
<h3>
<a id="user-content-31-終了する" class="anchor" href="#31-%E7%B5%82%E4%BA%86%E3%81%99%E3%82%8B" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3.1 終了する</h3>
<p>ブラウザを閉じるだけでよいです。<br>
AWS Cloud9 の環境はデフォルト設定で、30分無操作で停止状態になります。</p>
<p><a href="../image/c9_17.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/c9_17.PNG" alt="" style="max-width:100%;"></a></p>
<h3>
<a id="user-content-32-cloud9-の環境を削除する" class="anchor" href="#32-cloud9-%E3%81%AE%E7%92%B0%E5%A2%83%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3.2 cloud9 の環境を削除する</h3>
<p>必要のない場合は削除します。</p>
<p>AWS マネジメントコンソールから cloud9 サービスを選択し、作成した環境を選択した後、「Delete」をクリックします。</p>
<p><a href="../image/c9_18.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/c9_18.PNG" alt="" style="max-width:100%;"></a></p>
<p>確認画面が表示されますので、削除したい環境を十分に確認したらテキストボックスに「Delete」と入力した後、「Delete」ボタンを押します。</p>
<p><a href="../image/c9_19.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/c9_19.PNG" alt="" style="max-width:100%;"></a></p>
<p>アタッチしたボリュームを削除します。</p>
<p>AWS マネジメントコンソールから ec2 サービスを選択し、左端のメニューから「ボリューム」を選択し、ボリュームを表示します。<br>
今回作成したボリュームを選択した後、「アクション」→「Delete Volume」をクリックします。</p>
<p><a href="../image/ec2_32.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_32.PNG" alt="" style="max-width:100%;"></a></p>
<p>確認画面が表示されますので、内容を確認したら、「はい、削除する」ボタンを押します。</p>
<p><a href="../image/ec2_33.PNG" target="_blank" rel="noopener noreferrer"><img src="../image/ec2_33.PNG" alt="" style="max-width:100%;"></a></p>

</div>

<script>
    $('.toc').toc({
        'container': '#contents',
        'selectors': 'h2, h3',
    });
</script>
</body>
</html>
